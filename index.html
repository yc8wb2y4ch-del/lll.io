<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÉèÁ¥†È£éÂØìË®ÄÔºöÁãºÊù•‰∫Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121212;
            --ui-bg: #2d2436;
            --ui-border: #e0c0a0;
            --text-color: #ffffff;
            --highlight: #ffd54f;
            --danger: #ff5252;
            --success: #69f0ae;
        }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'DotGothic16', sans-serif; 
            overflow: hidden;
            color: white;
            user-select: none;
        }

        #game-container {
            width: 960px;
            height: 540px;
            background-color: #000;
            position: relative;
            box-shadow: 0 0 60px rgba(0,0,0,0.8);
            border: 4px solid var(--ui-border);
            display: flex;
            flex-direction: column;
            image-rendering: pixelated; 
        }

        /* --- Âú∫ÊôØÂ±Ç --- */
        #scene-layer {
            flex: 1; 
            height: 75%;
            position: relative;
            background-size: cover;
            background-position: center;
            overflow: hidden;
            border-bottom: 4px solid var(--ui-border);
            background-color: #87CEEB;
            transition: background-image 0.5s;
        }

        /* ËßíËâ≤ÈÄöÁî® */
        .sprite {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            height: 85%;
            width: auto;
            z-index: 20; 
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.3));
            transition: all 0.3s;
        }

        /* --- ÁæäÁæ§Â±Ç (Êñ∞Âä®Áîª) --- */
        #sheep-layer {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 5; 
            pointer-events: none; display: none; 
        }
        .sheep {
            position: absolute; width: 60px; height: auto;
            filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.2));
        }
        
        /* 1. ‰ªéÂ∑¶‰æßÁºìÊÖ¢ËøõÂÖ• */
        .sheep-enter-left {
            bottom: 20%;
            animation: walkFromLeft 40s linear infinite;
        }
        @keyframes walkFromLeft {
            from { left: -10%; transform: scaleX(1); }
            to { left: 110%; transform: scaleX(1); }
        }

        /* 2. ‰ªéÂè≥‰æßÁºìÊÖ¢ËøõÂÖ• */
        .sheep-enter-right {
            bottom: 35%;
            animation: walkFromRight 45s linear infinite;
        }
        @keyframes walkFromRight {
            from { left: 110%; transform: scaleX(-1); }
            to { left: -10%; transform: scaleX(-1); }
        }

        /* 3. ‰∏≠Èó¥ÂæòÂæä 1 */
        .sheep-wander-1 {
            bottom: 15%;
            left: 30%;
            animation: wanderSlow1 20s ease-in-out infinite alternate;
        }
        @keyframes wanderSlow1 {
            0% { transform: translateX(0) scaleX(1); }
            49% { transform: translateX(100px) scaleX(1); }
            50% { transform: translateX(100px) scaleX(-1); }
            100% { transform: translateX(0) scaleX(-1); }
        }

        /* 4. ‰∏≠Èó¥ÂæòÂæä 2 */
        .sheep-wander-2 {
            bottom: 25%;
            left: 70%;
            animation: wanderSlow2 25s ease-in-out infinite alternate-reverse;
        }
        @keyframes wanderSlow2 {
            0% { transform: translateX(0) scaleX(-1); }
            49% { transform: translateX(-120px) scaleX(-1); }
            50% { transform: translateX(-120px) scaleX(1); }
            100% { transform: translateX(0) scaleX(1); }
        }

        /* ÁæäÁæ§ÈÄÉË∑ëÂä®Áîª (Â§çÁî®) */
        .anim-sheep-scatter-left { animation: sheepScatterLeft 0.4s forwards ease-in !important; }
        @keyframes sheepScatterLeft { to { left: -50%; opacity: 0; } }
        .anim-sheep-scatter-right { animation: sheepScatterRight 0.4s forwards ease-in !important; }
        @keyframes sheepScatterRight { to { left: 150%; opacity: 0; } }

        /* Á´†ËäÇÊ†áÈ¢òÂä®Áîª */
        #chapter-title {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 80px; color: #fff; text-shadow: 4px 4px 0 #3E2723, -2px -2px 0 #5D4037;
            z-index: 100; opacity: 0; pointer-events: none; white-space: nowrap;
        }
        .anim-title-show { animation: titleFade 2s forwards ease-in-out; }
        @keyframes titleFade { 0% { opacity: 0; transform: translate(-50%, -40%); } 20% { opacity: 1; transform: translate(-50%, -50%); } 80% { opacity: 1; transform: translate(-50%, -50%); } 100% { opacity: 0; transform: translate(-50%, -60%); } }

        /* ËßíËâ≤Âä®ÁîªÂÆö‰πâ */
        .anim-idle { animation: breathe 3s infinite ease-in-out; }
        .anim-jump { animation: jump 0.5s infinite alternate; }
        .anim-shake { animation: shake 0.2s infinite; }
        .anim-run-in { animation: runIn 1s forwards; }
        .anim-wolf-enter { animation: wolfEnter 2s forwards; }
        .anim-sing-body { animation: singBody 1s infinite alternate ease-in-out; }
        .anim-drool { animation: drool 1.5s infinite; }
        .anim-villagers-leave { animation: villagersLeave 1.5s forwards ease-out; }
        @keyframes villagersLeave { to { transform: translateX(-150%); opacity: 0; } }

        /* --- ÁãºÁöÑÁâπÊÆäÂä®Áîª --- */
        .anim-wolf-pop { left: 50% !important; animation: wolfPop 0.6s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes wolfPop { 0% { transform: translateX(-50%) scale(0); opacity: 0; } 70% { transform: translateX(-50%) scale(1.4); opacity: 1; } 100% { transform: translateX(-50%) scale(1); opacity: 1; } }
        .anim-wolf-approach { animation: wolfMoveAttack 5s linear forwards; }
        @keyframes wolfMoveAttack { 0% { left: 85%; transform: translateX(-50%) scale(1); } 100% { left: 25%; transform: translateX(-50%) scale(1.2); } }
        .anim-wolf-flee { animation: wolfRunAway 1.5s forwards ease-in; transform: translateX(-50%) scaleX(-1) !important; }
        @keyframes wolfRunAway { to { left: 120%; opacity: 0; } }

        /* --- ÊùëÊ∞ëÁßªÂä®Âä®Áîª (Slide In) --- */
        .anim-slide-in-left-stop { animation: slideInLeftStop 1.0s forwards ease-out; }
        @keyframes slideInLeftStop { from { left: -20%; } to { left: 20%; } }
        
        .anim-slide-in-right-stop { animation: slideInRightStop 1.0s forwards ease-out; }
        @keyframes slideInRightStop { from { right: -20%; } to { right: 20%; } }

        /* --- ÊùëÊ∞ëÂÜ≤ÈîãÂä®Áîª (ÁªìÂ±Ä) --- */
        .anim-villager-charge-1 { animation: chargeIn 1.5s forwards ease-out; }
        .anim-villager-charge-2 { animation: chargeIn 2.0s forwards ease-out; }
        .anim-villager-charge-3 { animation: chargeIn 2.5s forwards ease-out; }
        @keyframes chargeIn { from { left: -20%; } to { left: var(--target-left, 40%); } }

        @keyframes scratch { 0%, 100% { transform: translateX(-50%) rotate(0deg); } 50% { transform: translateX(-50%) rotate(2deg); } }
        @keyframes singBody { 0% { transform: translateX(-50%) translateY(0); } 100% { transform: translateX(-50%) translateY(-5px); } }
        @keyframes breathe { 0% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.02); } }
        @keyframes jump { 0% { transform: translateX(-50%) translateY(0); } 100% { transform: translateX(-50%) translateY(-20px); } }
        @keyframes shake { 0% { transform: translateX(-52%); } 50% { transform: translateX(-48%); } 100% { transform: translateX(-52%); } }
        @keyframes runIn { from { left: -20%; } to { left: 20%; } }
        @keyframes wolfEnter { from { left: 120%; opacity: 0; } to { left: 70%; opacity: 1; } }
        @keyframes drool { 0% { stroke-dasharray: 0, 20; stroke-dashoffset: 0; opacity: 0; } 50% { opacity: 1; } 100% { stroke-dasharray: 10, 20; stroke-dashoffset: -10; opacity: 0; } }

        /* --- UIÂ±Ç --- */
        #ui-layer { height: 140px; background-color: var(--ui-bg); display: flex; padding: 10px 15px; box-sizing: border-box; gap: 15px; position: relative; flex-shrink: 0; z-index: 30; }
        #portrait-frame { height: 100%; aspect-ratio: 1 / 1; background: #1a1520; border: 3px solid var(--ui-border); flex-shrink: 0; display: flex; justify-content: center; align-items: center; border-radius: 4px; }
        #portrait-img { width: 85%; height: 85%; object-fit: contain; }
        #dialogue-area { flex-grow: 1; display: flex; flex-direction: column; position: relative; padding-right: 40px; }
        #name-tag { background-color: var(--highlight); color: #3e2723; padding: 4px 10px; border-radius: 2px; font-size: 16px; font-weight: bold; width: fit-content; margin-bottom: 5px; border: 1px solid #fff; }
        #text-content { font-size: 18px; line-height: 1.6; color: #f0f0f0; margin-right: 200px; text-shadow: 2px 2px 0 #000; }
        #choices-box { position: absolute; bottom: 0; right: 0; display: flex; flex-direction: column; gap: 6px; align-items: flex-end; z-index: 50; }
        .pixel-btn { background: #fff; color: #333; border: 2px solid #555; padding: 6px 14px; font-family: inherit; font-size: 16px; cursor: pointer; box-shadow: 0 4px 0 #333; text-align: right; transition: all 0.2s; }
        .pixel-btn:hover { background: #ffeb3b; transform: translateY(-2px); border-color: #fbc02d; color: #000; }
        
        #restart-btn { 
            position: absolute; top: 0; right: 0; 
            background: transparent; border: none; color: #aaa; 
            font-size: 24px; cursor: pointer; transition: all 0.5s ease; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center;
        }
        #restart-btn:hover { color: #ff5252; transform: rotate(360deg) scale(1.2); }
        .next-indicator { position: absolute; bottom: 5px; right: 5px; width: 12px; height: 12px; background: #fff; clip-path: polygon(0 0, 0% 100%, 100% 50%); animation: blink 1s infinite; cursor: pointer; }
        @keyframes blink { 0%,100% {opacity:1} 50% {opacity:0.3} }

        #status-bar { position: absolute; top: 20px; right: 20px; display: none; gap: 15px; z-index: 50; }
        .stat-box { background: rgba(0, 0, 0, 0.7); border: 2px solid #fff; padding: 8px 16px; border-radius: 4px; display: flex; align-items: center; gap: 10px; font-size: 24px; position: relative; }
        .stat-value { color: var(--highlight); font-weight: bold; min-width: 40px; text-align: right; }
        .stat-change { position: absolute; top: 100%; right: 0; font-weight: bold; font-size: 20px; opacity: 0; pointer-events: none; }
        .change-anim { animation: floatUp 1.5s forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-30px); } }

        /* Â§ö‰∫∫Â±Ç (Áî®‰∫éÁãºÂíåÊîæÁæäÂ®É) */
        #multi-char-layer { position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; display: none; z-index: 25; }
        .sub-sprite { position: absolute; bottom: -10px; height: 70%; width: auto; filter: drop-shadow(4px 4px 0 rgba(0,0,0,0.5)); transition: none; }

        /* Ë°®ÊÉÖÊ∞îÊ≥° */
        .emote-icon {
            position: absolute; width: 50px; height: 50px; z-index: 40; display: none;
            filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.5));
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0) translateY(10px); } to { transform: scale(1) translateY(0); } }

        /* ÊùëÊ∞ëÂ±Ç (‰∏ìÈó®Áî®‰∫é3‰∏™ÊùëÊ∞ë) */
        #villager-layer { position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; display: none; z-index: 24; }

        /* --- ËøõÂ∫¶Êù°Ê†∑Âºè (5s) --- */
        #qte-bar-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 10px;
            background: #333; display: none; z-index: 100;
        }
        #qte-bar {
            width: 100%; height: 100%; background: #ff5252;
            transform-origin: left;
        }
        .anim-timer { animation: shrinkBar 5s linear forwards; }
        @keyframes shrinkBar { from { transform: scaleX(1); } to { transform: scaleX(0); } }

        /* --- ÁãºÁ™ÅËÑ∏ (Jumpscare) --- */
        #jumpscare-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; z-index: 200; display: none;
            justify-content: center; align-items: center;
            overflow: hidden;
        }
        #wolf-bite-img {
            width: 100%; height: 100%; object-fit: cover;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            animation: biteClose 0.4s forwards ease-in;
        }
        @keyframes biteClose {
            0% { transform: scale(1.5); clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); background-color: black; } 
        }
        /* Á∫ØÈªëË¶ÜÁõñÂ±Ç */
        .blackout-mode {
            background-color: #000 !important;
            background-image: none !important;
        }
        
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <div class="stat-box">
            <span class="stat-icon">ü§ù</span>
            <span class="stat-text">‰ø°Áî®ÂÄº:</span>
            <span id="credit-val" class="stat-value">80</span>
            <span id="credit-change" class="stat-change"></span>
        </div>
    </div>

    <!-- Âú∫ÊôØÂ±Ç -->
    <div id="scene-layer">
        <div id="chapter-title"></div>
        
        <!-- ÁæäÁæ§Â±Ç (Êõ¥Êñ∞ÁªìÊûÑ) -->
        <div id="sheep-layer">
            <img class="sheep sheep-enter-left" src="">
            <img class="sheep sheep-enter-right" src="">
            <img class="sheep sheep-wander-1" src="">
            <img class="sheep sheep-wander-2" src="">
        </div>

        <!-- ËøõÂ∫¶Êù° (QTE) -->
        <div id="qte-bar-container">
            <div id="qte-bar"></div>
        </div>

        <img id="main-char" src="" class="sprite anim-idle" style="display:none;">
        
        <!-- Áãº & ÊîæÁæäÂ®É ‰∫íÂä®Â±Ç -->
        <div id="multi-char-layer">
            <img id="extra-char-1" class="sub-sprite" style="display:none;">
            <img id="emote-1" class="emote-icon" style="display:none;"> <!-- Ë°®ÊÉÖÊ∞îÊ≥°1 -->
            
            <img id="extra-char-2" class="sub-sprite" style="display:none;">
            <img id="emote-2" class="emote-icon" style="display:none;"> <!-- Ë°®ÊÉÖÊ∞îÊ≥°2 -->
        </div>

        <!-- ‰∏âÊùëÊ∞ëÂ±Ç -->
        <div id="villager-layer">
            <img id="villager-1" class="sub-sprite" style="display:none;">
            <img id="villager-2" class="sub-sprite" style="display:none;">
            <img id="villager-3" class="sub-sprite" style="display:none;">
        </div>

        <!-- ÁãºÁ™ÅËÑ∏Â±Ç -->
        <div id="jumpscare-layer">
            <img id="wolf-bite-img" src="">
        </div>
    </div>

    <div id="ui-layer">
        <div id="portrait-frame" style="visibility: hidden;">
            <img id="portrait-img" src="">
        </div>

        <div id="dialogue-area">
            <button id="restart-btn" onclick="restartGame()" title="ÈáçÊñ∞ÂºÄÂßã">‚Üª</button>
            <div id="name-tag">Á≥ªÁªü</div>
            <div id="text-content">...</div>
            <div id="choices-box"></div>
            <div id="next-btn" class="next-indicator" style="display:none;"></div>
        </div>
    </div>
</div>

<script>
    const svgToUrl = (svg) => 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);

    // ËÉåÊôØ
    const svgBgClassroom = `<svg width="960" height="540" viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect width="960" height="540" fill="#F2E6D8"/> <rect y="400" width="960" height="140" fill="#8D6E63"/><path d="M0 430 H960 M0 460 H960 M0 490 H960" stroke="#6D4C41" stroke-width="2"/><rect x="230" y="60" width="500" height="280" fill="#5D4037"/> <rect x="250" y="80" width="460" height="240" fill="#2E4D35"/> <rect x="250" y="320" width="460" height="15" fill="#8D6E63"/><rect x="400" y="322" width="20" height="4" fill="#FFF"/> <rect x="430" y="322" width="20" height="4" fill="#EF9A9A"/><text x="480" y="210" font-family="monospace" font-weight="bold" font-size="60" fill="#FFFFFF" text-anchor="middle">ÁãºÊù•‰∫Ü</text><text x="680" y="290" font-family="monospace" font-weight="bold" font-size="20" fill="#CCCCCC" text-anchor="end">ÂÖ≥‰∫é‰ø°Áî®ÁöÑÊïÖ‰∫ã</text><rect x="200" y="420" width="560" height="120" fill="#795548"/> <rect x="180" y="420" width="600" height="20" fill="#5D4037"/><rect x="850" y="440" width="60" height="60" fill="#D84315"/> <rect x="840" y="440" width="80" height="15" fill="#BF360C"/> <rect x="860" y="450" width="40" height="40" fill="#E64A19" opacity="0.3"/> <rect x="880" y="400" width="5" height="50" fill="#33691E"/> <rect x="860" y="410" width="5" height="40" fill="#33691E"/> <rect x="900" y="420" width="5" height="30" fill="#33691E"/><rect x="830" y="380" width="40" height="40" fill="#2E7D32"/> <rect x="840" y="390" width="20" height="20" fill="#4CAF50"/> <rect x="870" y="340" width="50" height="50" fill="#43A047"/> <rect x="880" y="350" width="30" height="30" fill="#81C784"/> <rect x="910" y="380" width="10" height="10" fill="#2E7D32"/> <rect x="910" y="390" width="30" height="40" fill="#388E3C"/> <rect x="920" y="400" width="10" height="10" fill="#81C784"/></svg>`;
    const bgHillDay = `<svg width="960" height="540" viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect width="960" height="540" fill="#87CEEB"/><circle cx="800" cy="80" r="50" fill="#FFF68F" opacity="0.8"/><path d="M0 300 Q480 200 960 300 V540 H0 Z" fill="#8BC34A"/><path d="M0 350 Q480 250 960 350 V540 H0 Z" fill="#7CB342"/><rect x="100" y="320" width="10" height="30" fill="#5D4037"/><circle cx="105" cy="310" r="25" fill="#2E7D32"/><rect x="850" y="280" width="10" height="30" fill="#5D4037"/><circle cx="855" cy="270" r="25" fill="#2E7D32"/><g fill="#FFF" opacity="0.9"><circle cx="200" cy="100" r="30"/><circle cx="240" cy="90" r="40"/><circle cx="280" cy="100" r="30"/></g></svg>`;
    const bgHillEvening = `<svg width="960" height="540" viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect width="960" height="540" fill="#283593"/><path d="M0 300 Q480 200 960 300 V540 H0 Z" fill="#558B2F"/><path d="M0 350 Q480 250 960 350 V540 H0 Z" fill="#33691E"/><rect x="100" y="320" width="10" height="30" fill="#3E2723"/><circle cx="105" cy="310" r="25" fill="#1B5E20"/><rect x="850" y="280" width="10" height="30" fill="#3E2723"/><circle cx="855" cy="270" r="25" fill="#1B5E20"/></svg>`;

    // ËßíËâ≤
    const boyBase = (face, armStyle = 'normal') => {
        let arms = `<rect x="18" y="34" width="4" height="14" fill="#FFCCBC"/><rect x="42" y="34" width="4" height="14" fill="#FFCCBC"/>`;
        if (armStyle === 'scratch') {
            arms = `<rect x="16" y="22" width="4" height="12" fill="#FFCCBC" transform="rotate(-20 18 34)"/><rect x="42" y="34" width="4" height="14" fill="#FFCCBC"/>`;
        }
        return `<svg width="300" height="400" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="26" y="20" width="12" height="14" fill="#FFCCBC"/><rect x="24" y="16" width="16" height="6" fill="#8D6E63"/><rect x="22" y="34" width="20" height="18" fill="#42A5F5"/><rect x="22" y="52" width="8" height="10" fill="#5D4037"/><rect x="34" y="52" width="8" height="10" fill="#5D4037"/>${arms}<rect x="44" y="25" width="4" height="40" fill="#8D6E63"/>${face}</svg>`;
    };
    
    // ‰ª•‰∏ã‰∏∫Ê†πÊçÆ„ÄêÂΩ¢Ë±°‰øÆÊîπ„ÄëÊõøÊç¢ÂêéÁöÑ‰ª£Á†ÅÂùó
    const boyInjuredSvg = boyBase(`<rect x="29" y="26" width="2" height="2" fill="#000"/><rect x="35" y="26" width="2" height="2" fill="#000"/><rect x="29" y="28" width="2" height="4" fill="#29B6F6"/><rect x="35" y="28" width="2" height="4" fill="#29B6F6"/><rect x="31" y="31" width="4" height="2" fill="#D84315"/>`).replace('</svg>', `<g opacity="0.6"><rect x="24" y="34" width="4" height="4" fill="#5D4037"/></g></svg>`);

    const boySingingSvg = `<svg width="300" height="400" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><style>.note { animation: floatNote 1s infinite; opacity: 0; } @keyframes floatNote { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-10px); opacity: 0; } }</style><rect x="26" y="20" width="12" height="14" fill="#FFCCBC"/><rect x="24" y="16" width="16" height="6" fill="#8D6E63"/><rect x="22" y="34" width="20" height="18" fill="#42A5F5"/><rect x="22" y="52" width="8" height="10" fill="#5D4037"/><rect x="34" y="52" width="8" height="10" fill="#5D4037"/><rect x="18" y="34" width="4" height="14" fill="#FFCCBC"/><rect x="42" y="34" width="4" height="14" fill="#FFCCBC"/><rect x="44" y="25" width="4" height="40" fill="#8D6E63"/><rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/><rect x="31" y="30" width="4" height="4" fill="#3E2723"/><path d="M45 15 L45 10 L50 10 L50 15" stroke="#FFEB3B" stroke-width="2" fill="none" class="note" style="animation-delay: 0s"/><path d="M15 18 L15 13 L20 13 L20 18" stroke="#F48FB1" stroke-width="2" fill="none" class="note" style="animation-delay: 0.5s"/><rect x="48" y="20" width="2" height="2" fill="#69F0AE" class="note" style="animation-delay: 0.2s"/></svg>`;

    const faceNormal = `<rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/><rect x="31" y="30" width="4" height="2" fill="#D84315"/>`;
    const faceLaugh = `<rect x="29" y="26" width="2" height="2" fill="#000"/><rect x="35" y="26" width="2" height="2" fill="#000"/><path d="M30 30 H36 V32 H30 Z" fill="#FFF"/>`;
    const faceScared = `<rect x="29" y="24" width="2" height="3" fill="#000"/><rect x="35" y="24" width="2" height="3" fill="#000"/><rect x="30" y="30" width="6" height="4" fill="#000"/>`;
    const faceCry = `<rect x="29" y="26" width="2" height="2" fill="#000"/><rect x="35" y="26" width="2" height="2" fill="#000"/><rect x="29" y="28" width="2" height="4" fill="#29B6F6"/><rect x="35" y="28" width="2" height="4" fill="#29B6F6"/><rect x="31" y="31" width="4" height="2" fill="#D84315"/>`;
    const faceBored = `<rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/><rect x="31" y="31" width="4" height="1" fill="#3E2723"/>`;
    const facePout = `<rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/><path d="M31 29 A 2 2 0 0 1 31 31 A 2 2 0 0 1 31 33" stroke="#D84315" stroke-width="2" fill="none"/>`;
    const faceArrogant = `<rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/><path d="M30 32 L36 29" stroke="#3E2723" stroke-width="2" fill="none"/>`;

    const svgWolf = `<svg width="300" height="400" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><path d="M20 20 L30 10 L40 20 Z" fill="#616161"/><rect x="20" y="20" width="30" height="20" fill="#616161"/><rect x="25" y="40" width="4" height="15" fill="#424242"/><rect x="40" y="40" width="4" height="15" fill="#424242"/><rect x="25" y="25" width="4" height="2" fill="#76FF03"/><rect x="35" y="25" width="4" height="2" fill="#76FF03"/><rect x="20" y="32" width="10" height="6" fill="#FFF"/><rect x="20" y="32" width="4" height="2" fill="#000"/><path d="M15 25 L20 30 L20 20 Z" fill="#616161"/><path d="M22 36 Q20 45 22 50" stroke="#E0F7FA" stroke-width="2" fill="none" class="anim-drool"/></svg>`;
    const svgWolfBite = `<svg width="960" height="540" viewBox="0 0 960 540" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect width="960" height="540" fill="none"/><path d="M0 0 L960 0 L960 150 L800 250 L700 150 L600 250 L500 150 L400 250 L300 150 L200 250 L100 150 L0 250 Z" fill="#000"/><path d="M0 540 L960 540 L960 390 L800 290 L700 390 L600 290 L500 390 L400 290 L300 390 L200 290 L100 390 L0 290 Z" fill="#000"/><rect x="0" y="0" width="960" height="100" fill="#000"/><rect x="0" y="440" width="960" height="100" fill="#000"/></svg>`;
    const svgSweat = `<svg width="50" height="50" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 4 Q22 16 22 22 A6 6 0 0 1 10 22 Q10 16 16 4 Z" fill="#4FC3F7" stroke="#0288D1" stroke-width="2"/></svg>`;
    const svgAngry = `<svg width="50" height="50" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M4 4 L12 12 M12 4 L4 12" stroke="#D32F2F" stroke-width="4"/><path d="M20 8 L28 16 M28 8 L20 16" stroke="#D32F2F" stroke-width="4"/></svg>`;

    const villagerBase = (weaponSvg, angryEyes = false) => {
        const eyes = angryEyes 
            ? `<path d="M28 22 L32 26 M34 26 L38 22" stroke="#000" stroke-width="2"/>`
            : `<rect x="28" y="22" width="2" height="2" fill="#000"/><rect x="34" y="22" width="2" height="2" fill="#000"/>`;
            
        return `<svg width="300" height="400" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="26" y="18" width="12" height="12" fill="#FFCCBC"/><rect x="24" y="30" width="16" height="20" fill="#795548"/><rect x="26" y="50" width="4" height="10" fill="#3E2723"/><rect x="34" y="50" width="4" height="10" fill="#3E2723"/><rect x="40" y="30" width="4" height="20" fill="#A1887F"/><path d="M42 20 L50 10 L54 14 L46 24 Z" fill="#9E9E9E"/>${eyes}<rect x="30" y="26" width="4" height="2" fill="#000"/>${weaponSvg}</svg>`;
    };
    
    const wMachete = `<path d="M46 40 L46 20 Q56 10 56 30 Z" fill="#B0BEC5"/>`;
    const wStick = `<rect x="46" y="25" width="4" height="25" fill="#5D4037" transform="rotate(-15 48 40)"/>`;
    const wHoe = `<path d="M46 20 H54 V25" stroke="#5D4037" stroke-width="4"/><rect x="48" y="20" width="4" height="30" fill="#5D4037"/>`;

    const svgVillager = `<svg width="300" height="400" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="26" y="18" width="12" height="12" fill="#FFCCBC"/><rect x="24" y="30" width="16" height="20" fill="#795548"/><rect x="26" y="50" width="4" height="10" fill="#3E2723"/><rect x="34" y="50" width="4" height="10" fill="#3E2723"/><rect x="40" y="30" width="4" height="20" fill="#A1887F"/><path d="M42 20 L50 10 L54 14 L46 24 Z" fill="#9E9E9E"/><rect x="28" y="22" width="2" height="2" fill="#000"/><rect x="34" y="22" width="2" height="2" fill="#000"/><rect x="30" y="26" width="4" height="2" fill="#000"/></svg>`;
    const svgTeacherHead = `<svg width="100" height="100" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><path d="M24 4 H40 V16 H24 Z" fill="#2D1B17"/> <path d="M32 2 H36 V14 H34 V16 H32 Z" fill="#AA00FF"/><path d="M8 6 H22 V20 H8 Z" fill="#3E2723"/> <path d="M11 9 H19 V17 H11 Z" fill="#CE93D8"/><path d="M42 6 H56 V20 H42 Z" fill="#3E2723"/> <path d="M45 9 H53 V17 H45 Z" fill="#CE93D8"/><path d="M12 20 H52 V46 H48 V48 H16 V46 H12 Z" fill="#3E2723"/> <path d="M22 36 H42 V48 H22 Z" fill="#FFECB3"/><path d="M12 20 H52 V32 H14 V22 H12 Z" fill="#F8BBD0" opacity="0.6"/> <path d="M12 20 H52 V22 H12 Z" fill="#F8BBD0"/><rect x="16" y="32" width="12" height="10" fill="#263238"/> <rect x="17" y="33" width="10" height="8" fill="#00BCD4"/> <rect x="19" y="34" width="6" height="6" fill="#006064"/> <rect x="17" y="33" width="4" height="4" fill="#FFF"/><rect x="36" y="32" width="12" height="10" fill="#263238"/> <rect x="37" y="33" width="10" height="8" fill="#00BCD4"/> <rect x="39" y="34" width="6" height="6" fill="#006064"/> <rect x="37" y="33" width="4" height="4" fill="#FFF"/><rect x="31" y="44" width="2" height="2" fill="#F06292"/></svg>`;
    const svgBoyHead = `<svg width="100" height="100" viewBox="20 10 24 30" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="26" y="20" width="12" height="14" fill="#FFCCBC"/><rect x="24" y="16" width="16" height="6" fill="#8D6E63"/><rect x="29" y="25" width="2" height="2" fill="#000"/><rect x="35" y="25" width="2" height="2" fill="#000"/></svg>`;
    const svgSheep = `<svg width="64" height="64" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="10" y="12" width="14" height="10" fill="#FFF"/><rect x="8" y="10" width="8" height="8" fill="#ECEFF1"/><rect x="10" y="22" width="2" height="4" fill="#333"/><rect x="20" y="22" width="2" height="4" fill="#333"/><rect x="9" y="12" width="2" height="2" fill="#333"/><rect x="13" y="12" width="2" height="2" fill="#333"/></svg>`;
    const svgSheepDead = `<svg width="64" height="64" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><g transform="rotate(90 16 16)"><rect x="10" y="12" width="14" height="10" fill="#FFF"/><rect x="8" y="10" width="8" height="8" fill="#ECEFF1"/><rect x="10" y="22" width="2" height="4" fill="#333"/><rect x="20" y="22" width="2" height="4" fill="#333"/><path d="M9 12 L11 14 M11 12 L9 14" stroke="#333" stroke-width="1"/><path d="M13 12 L15 14 M15 12 L13 14" stroke="#333" stroke-width="1"/></g></svg>`;
    // ÁªìÊùüÊõøÊç¢
    
    const svgSheepLost = `<svg width="64" height="64" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"><rect x="10" y="12" width="14" height="10" fill="#FFF"/><rect x="8" y="10" width="8" height="8" fill="#ECEFF1"/><rect x="10" y="22" width="2" height="4" fill="#333"/><rect x="20" y="22" width="2" height="4" fill="#333"/><rect x="9" y="12" width="2" height="2" fill="#333"/><rect x="13" y="12" width="2" height="2" fill="#333"/><path d="M10 14 h12 M10 17 h12" stroke="#D32F2F" stroke-width="2" opacity="0.7"/></svg>`;


    const assets = {
        bg: { day: svgToUrl(bgHillDay), evening: svgToUrl(bgHillEvening), class: svgToUrl(svgBgClassroom) },
        char: {
            boyNormal: svgToUrl(boyBase(faceNormal)),
            boyScratch: svgToUrl(boyBase(faceBored, 'scratch')),
            boySing: svgToUrl(boySingingSvg),
            boyLaugh: svgToUrl(boyBase(faceLaugh)),
            boyScared: svgToUrl(boyBase(faceScared)),
            boyCry: svgToUrl(boyBase(faceCry)),
            boyPout: svgToUrl(boyBase(facePout)), 
            boyArrogant: svgToUrl(boyBase(faceArrogant)), 
            boyInjured: svgToUrl(boyInjuredSvg), 
            wolf: svgToUrl(svgWolf),
            wolfBite: svgToUrl(svgWolfBite),
            villager: svgToUrl(svgVillager),
            vMachete: svgToUrl(villagerBase(wMachete)),
            vStick: svgToUrl(villagerBase(wStick)),
            vMacheteAngry: svgToUrl(villagerBase(wMachete, true)), 
            vStickAngry: svgToUrl(villagerBase(wStick, true)), 
            vHoe: svgToUrl(villagerBase(wHoe))
        },
        emote: { sweat: svgToUrl(svgSweat), angry: svgToUrl(svgAngry) },
        head: { teacher: svgToUrl(svgTeacherHead), boy: svgToUrl(svgBoyHead) },
        sheep: svgToUrl(svgSheep),
        sheepDead: svgToUrl(svgSheepDead),
        sheepLost: svgToUrl(svgSheepLost)
    };

    let creditScore = 80;
    let qteTimer; 

    function updateCredit(change) {
        creditScore += change;
        if (creditScore < 0) creditScore = 0;
        if (creditScore > 100) creditScore = 100;

        const elVal = document.getElementById('credit-val');
        const elChange = document.getElementById('credit-change');
        
        elVal.innerText = creditScore;
        elVal.style.color = creditScore < 50 ? 'var(--danger)' : (creditScore >= 90 ? 'var(--success)' : 'var(--highlight)');

        if (change !== 0) {
            elChange.innerText = change > 0 ? `+${change}` : `${change}`;
            elChange.style.color = change > 0 ? 'var(--success)' : 'var(--danger)';
            elChange.classList.remove('change-anim');
            void elChange.offsetWidth; 
            elChange.classList.add('change-anim');
        }
    }

    const getWolfEnding = () => {
        if (creditScore < 50) return 30; // ÁªìÂ±Ä‰∏Ä (Bad)
        if (creditScore >= 50 && creditScore < 90) return 31; // ÁªìÂ±Ä‰∫å (Neutral)
        if (creditScore >= 90) return 32; // ÁªìÂ±Ä‰∏â (Good)
        return 30; // ÈªòËÆ§ËøîÂõûBadÁªìÂ±Ä
    };

    const script = [
        // Â£π ¬∑ ËØæÁ®ãÂºïÂÖ•
        {
            id: 1,
            bg: assets.bg.class,
            char: null, 
            head: assets.head.teacher, 
            hideStatus: true, 
            name: "ÈúìËÄÅÂ∏à",
            text: "ÂêåÂ≠¶‰ª¨Â•ΩÔºÅÊ¨¢ËøéÊù•Âà∞Êàë‰ª¨ÁöÑÂØìË®Ä‰∫íÂä®ËØæÂ†Ç„ÄÇ‰ªäÂ§©ÔºåÊàë‰ª¨Ë¶Å‰∏ÄËµ∑Ëµ∞Ëøõ‰∏Ä‰∏™ÈùûÂ∏∏ÁªèÂÖ∏ÁöÑÊïÖ‰∫ã‚Äî‚Äî„ÄäÁãºÊù•‰∫Ü„Äã„ÄÇ",
            next: 1.1
        },
        {
            id: 1.1,
            bg: assets.bg.class,
            char: null,
            head: assets.head.teacher,
            hideStatus: true,
            name: "ÈúìËÄÅÂ∏à",
            text: "‰Ω†Â∞Ü‰∫≤Ëá™ÊâÆÊºîÊïÖ‰∫ãÁöÑ‰∏ª‰∫∫ÂÖ¨Ôºå‰Ω†ÁöÑÊØè‰∏Ä‰∏™ÈÄâÊã©ÔºåÈÉΩÂ∞ÜÂÜ≥ÂÆö‰Ω†Ëá™Â∑±ÁöÑÂëΩËøêÂíåÊï¥‰∏™ÊùëÂ∫ÑÁöÑÊú™Êù•„ÄÇÂáÜÂ§áÂ•Ω‰∫ÜÂêóÔºüËÆ©Êàë‰ª¨ËøõÂÖ•Ê∏∏ÊàèÔºåÁúãÁúã‚Äò‰ø°Áî®‚ÄôÁ©∂Á´üÊúâÂ§öÈáçË¶ÅÂêßÔºÅ",
            choices: [{ txt: "ÂáÜÂ§áÂ•Ω‰∫ÜÔºåËøõÂÖ•Ê∏∏ÊàèÔºÅ", to: 2 }]
        },
        // Ë¥∞ ¬∑ ÊïÖ‰∫ãËÉåÊôØ
        {
            id: 2,
            bg: assets.bg.day,
            char: assets.char.boyNormal,
            anim: "anim-idle",
            head: assets.head.boy,
            hideStatus: false,
            showSheep: true, 
            name: "ÊóÅÁôΩ",
            text: "‰Ω†ÊòØ‰∏Ä‰∏™Â∞èÁâßÁ´•ÔºåÊØèÂ§©ÁöÑÂ∑•‰ΩúÂ∞±ÊòØÊääÁæäÁæ§Ëµ∂Âà∞ËøôÁâáÂ±±Âù°‰∏ä„ÄÇÊó•Â≠ê‰∏ÄÂ§©Â§©ËøáÂéªÔºåÈô§‰∫ÜËìùÂ§©„ÄÅÁôΩ‰∫ëÂíåÂÆâÈùôÂêÉËçâÁöÑÁæäÔºå‰ªÄ‰πàÈÉΩÊ≤°ÊúâÂèëÁîü„ÄÇ",
            next: 2.1
        },
        {
            id: 2.1,
            bg: assets.bg.day,
            char: assets.char.boyScratch, // Êå†Â§¥Êó†ËÅä
            anim: "anim-idle",
            head: assets.head.boy,
            hideStatus: false,
            showSheep: true,
            name: "ÊóÅÁôΩ",
            text: "ËôΩÁÑ∂ÂæàÂÆâÂÖ®Ôºå‰ΩÜ‰πü‚Ä¶‚Ä¶ÈùûÂ∏∏Êó†ËÅä„ÄÇ‰Ω†ÁúãÁùÄÂ±±‰∏ãÈÇ£‰∏™ÂÆÅÈùôÁöÑÊùëÂ∫ÑÔºå‰∏Ä‰∏™ÂøµÂ§¥Á™ÅÁÑ∂‰ªéÂøÉÂ∫ïÂÜí‰∫ÜÂá∫Êù•„ÄÇ",
            next: 3
        },
        // ÂèÅ ¬∑ Ê∏∏ÊàèÂÖ≥Âç°
        // ÂÖ≥Âç°‰∏Ä
        {
            id: 3,
            bg: assets.bg.day,
            char: assets.char.boyBored,
            anim: "anim-idle",
            head: assets.head.boy,
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "Â§™Èò≥ÊåÇÂú®Â§©‰∏äÔºåÊöñÊ¥ãÊ¥ãÁöÑÔºåËÆ©‰∫∫ÊòèÊòèÊ¨≤Áù°„ÄÇÊàëÂ•ΩÊó†ËÅäÂïäÔºåÊÉ≥ÊâæÁÇπ‰πêÂ≠ê„ÄÇÂè™Ë¶ÅÊàëÂ§ßÂñä‰∏ÄÂ£∞ÔºåÂ±±‰∏ãÁöÑÊùëÊ∞ë‰ª¨Â∞±‰ºöÁ´ãÂàªË∑ë‰∏äÊù•...",
            choices: [
                { txt: "A. ÂØπÁùÄÂ±±‰∏ãÂ§ßÂñäÔºö‚ÄúÁãºÊù•‰∫ÜÔºÅ‚Äù", to: 4, action: () => updateCredit(-30) },
                { txt: "B. Âî±‰∏ÄÊîØÊÇ†Êâ¨ÁöÑÁâßÁæäÂ∞èË∞É„ÄÇ", to: 5, action: () => updateCredit(5) }
            ]
        },
        // ÂÖ≥Âç°‰∏Ä -> A
        {
            id: 4,
            bg: assets.bg.day,
            char: "VILLAGERS_RUN_IN_WEAPONS", 
            head: assets.head.boy,
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "ÁãºÊù•‰∫ÜÔºÅÁãºÊù•‰∫ÜÔºÅÂìàÂìàÂìàÔºåÁúã‰ªñ‰ª¨ÊÉäÊÖåÂ§±Êé™ÁöÑÊ†∑Â≠êÔºåÁúüÊúâË∂£ÔºÅ",
            next: 4.1
        },
        {
            id: 4.1,
            bg: assets.bg.day,
            char: "VILLAGERS_ANGRY_LEAVING",
            showSheep: true,
            name: "ÊùëÊ∞ë",
            text: "‰Ω†ËøôÂ≠©Â≠êÔºÅÊÄé‰πàËÉΩÂºÄËøôÁßçÁé©Á¨ëÔºÅÊàë‰ª¨ÂÜç‰πü‰∏ç‰ø°‰Ω†‰∫ÜÔºÅ(ÊùëÊ∞ë‰ª¨ÁîüÊ∞îÂú∞Á¶ªÂºÄ‰∫Ü)",
            next: 6 // ËøõÂÖ•ÂÖ≥Âç°‰∫å
        },
        // ÂÖ≥Âç°‰∏Ä -> B
        {
            id: 5,
            bg: assets.bg.day,
            char: assets.char.boySing,
            anim: "anim-sing-body",
            head: assets.head.boy,
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "Âï¶Âï¶Âï¶... ÊàëÁöÑÊ≠åÂ£∞ËÆ©ÁæäÁæ§Êõ¥Âä†ÂÆâÁ®≥Ôºå‰πüÊéíËß£‰∫ÜËá™Â∑±ÁöÑÂ≠§Âçï„ÄÇ",
            next: 6 // ËøõÂÖ•ÂÖ≥Âç°‰∫å
        },
        // ÂÖ≥Âç°‰∫å
        {
            id: 6,
            bg: assets.bg.day,
            char: assets.char.boyNormal,
            head: assets.head.boy,
            anim: "anim-idle",
            showSheep: true,
            showTitle: "Âá†Â§©Âêé",
            text: "", // Âä®ÊÄÅÊñáÊú¨
            name: "Â∞èÁâßÁ´•",
            dynamicChoices: true
        },
        // ÂÖ≥Âç°‰∫å -> Âä®ÊÄÅÊäâÊã©
        {
            id: 6.1, // ‰∏ä‰∏ÄÂÖ≥ÈÄâ‰∫ÜA (‰ø°Áî®50)
            text: "Âá†Â§©ÂêéÔºåÊàëÂèàÊÑüÂà∞‰∫ÜÈÇ£ÁßçÁÜüÊÇâÁöÑÊó†ËÅä„ÄÇ‰∏äÊ¨°ÊùëÊ∞ë‰ª¨ÊÉäÊÖåÂ§±Êé™Ë∑ë‰∏äÊù•ÁöÑÊ†∑Â≠êÔºåÁé∞Âú®ÊÉ≥Ëµ∑Êù•ËøòËßâÂæóÂæàÂ•ΩÁ¨ë„ÄÇË¶Å‰∏çË¶ÅÂÜçÊù•‰∏ÄÊ¨°Âë¢Ôºü",
            choices: [
                { txt: "A. ÂÜçÊ¨°Â§ßÂñäÔºö‚ÄúÁãºÊù•‰∫ÜÔºÅ‚Äù", to: 7, action: () => updateCredit(-40) },
                { txt: "B. Êç¢‰∏ÄÁâáÊñ∞ÁöÑËçâÂú∞„ÄÇ", to: 8, action: () => updateCredit(5) }
            ]
        },
        {
            id: 6.2, // ‰∏ä‰∏ÄÂÖ≥ÈÄâ‰∫ÜB (‰ø°Áî®85)
            text: "Âá†Â§©ÂêéÔºåÊàë‰æùÊóßÂú®ËÆ§ÁúüÂú∞ÊîæÁæä„ÄÇËôΩÁÑ∂Êó•Â≠êÂπ≥Ê∑°Ôºå‰ΩÜÁúãÁùÄÁæäÁæ§ÂÆâÁÑ∂Êó†ÊÅôÔºåÊàëÊÑüÂà∞‰∏ÄÁßçË∏èÂÆûÁöÑË¥£‰ªªÊÑü„ÄÇ‰∏çËøáÔºåÊêû‰∏™ÊÅ∂‰ΩúÂâßÁöÑÊÉ≥Ê≥ïÂÅ∂Â∞îËøòÊòØ‰ºöÂÜíÂá∫Êù•„ÄÇ",
             choices: [
                { txt: "A. Âà∂ÈÄ†ÁÇπÈ™öÂä®ÔºåÂ§ßÂñäÔºö‚ÄúÁãºÊù•‰∫ÜÔºÅ‚Äù", to: 7, action: () => updateCredit(-40) },
                { txt: "B. ÁªßÁª≠ËÆ§ÁúüÊîæÁæä„ÄÇ", to: 8, action: () => updateCredit(5) }
            ]
        },
        // ÂÖ≥Âç°‰∫å -> A
        {
            id: 7,
            bg: assets.bg.day,
            char: "VILLAGERS_RUN_IN_WEAPONS", 
            head: assets.head.boy,
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "ÁãºÊù•‰∫ÜÔºÅÁãºÁúüÁöÑÊù•‰∫ÜÔºÅÂìàÂìàÂìàÔºÅ‰ªñ‰ª¨Âèà‰∏äÂΩì‰∫ÜÔºÅ",
            next: 7.1
        },
        {
            id: 7.1,
            bg: assets.bg.day,
            char: "VILLAGERS_ANGRY_LEAVING",
            showSheep: true,
            name: "ÊùëÊ∞ë",
            text: "‰Ω†Ëøô‰∏™È™ó‰∫∫ÁöÑÂ≠©Â≠êÔºÅÊàë‰ª¨ÂÜç‰πü‰∏ç‰ºöÁõ∏‰ø°‰Ω†ÁöÑÈ¨ºËØù‰∫ÜÔºÅ(ÊùëÊ∞ë‰ª¨ÂΩªÂ∫ïÂ§±ÊúõÂú∞Á¶ªÂºÄ‰∫Ü)",
            next: 10 // ËøõÂÖ•ÂÖ≥Âç°‰∏â
        },
        // ÂÖ≥Âç°‰∫å -> B
        {
            id: 8,
            bg: assets.bg.day,
            char: assets.char.boyNormal,
            head: assets.head.boy,
            anim: "anim-idle",
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "ËøôËæπÁöÑËçâÊõ¥Â´©ÔºåÁæäÂÑø‰ª¨Âø´Êù•ÂêÉÂêß„ÄÇÊàëÁöÑË¥£‰ªªÂ∞±ÊòØ‰øùÊä§Â•Ω‰Ω†‰ª¨„ÄÇ",
            next: 10 // ËøõÂÖ•ÂÖ≥Âç°‰∏â
        },

        // ÂÖ≥Âç°‰∏âÔºöÁãºÁúüÁöÑÊù•‰∫Ü
        {
            id: 10,
            bg: assets.bg.evening,
            char: assets.char.boyNormal,
            head: assets.head.boy,
            anim: "anim-idle",
            showSheep: true, 
            showTitle: "ÈªÑÊòèÊó∂ÂàÜ", 
            name: "ÊóÅÁôΩ",
            text: "ÈªÑÊòèÊó∂ÂàÜÔºåÊ≠£ÂΩì‰Ω†ÂáÜÂ§áËµ∂ÁùÄÁæäÁæ§‰∏ãÂ±±Êó∂ÔºåÊ†ëÊûóÈáåÁ™ÅÁÑ∂Á™úÂá∫‰∏ÄÂè™ÁúüÊ≠£ÁöÑ„ÄÅÁúºÁùõÈáåÂÜíÁùÄÁªøÂÖâÁöÑÊÅ∂ÁãºÔºÅ",
            next: 10.5
        },
        {
            id: 10.5,
            bg: assets.bg.evening,
            char: "WOLF_CENTER", 
            showSheep: true,
            name: "ÊóÅÁôΩ",
            text: "ÂÆÉÊµÅÁùÄÂè£Ê∞¥Ôºå‰∏ÄÊ≠•Ê≠•ÈÄºËøëÂêìÂæóÁëüÁëüÂèëÊäñÁöÑÁæäÁæ§„ÄÇ‰Ω†ÊÑüÂà∞‰∫ÜÂâçÊâÄÊú™ÊúâÁöÑÊÅêÊÉßÔºåÊãºÂ∞ΩÂÖ®ÂäõÂêëÂ±±‰∏ãÂëºÊïëÔºÅ",
            next: 11
        },
        {
            id: 11,
            bg: assets.bg.evening,
            char: "QTE_SCENE", 
            head: assets.head.boy,
            showSheep: true,
            name: "Â∞èÁâßÁ´•",
            text: "ÁãºÊù•‰∫ÜÔºÅÁãºÁúüÁöÑÊù•‰∫ÜÔºÅÊïëÂëΩÂïäÔºÅ(5ÁßíÂÜÖÁÇπÂáªÂëºÊïë)",
            choices: [
                { txt: "ÊãºÂ∞ΩÂÖ®ÂäõÂëºÊïëÔºÅ", dynamicNext: true } 
            ]
        },

        // ËÇÜ ¬∑ Ê∏∏ÊàèÁªìÂ±Ä
        // ÁªìÂ±Ä‰∏ÄÔºöÊó†‰∫∫Áõ∏‰ø°ÁöÑÂëºÂñä (Bad Ending)
        {
            id: 30,
            bg: assets.bg.evening,
            char: null, 
            head: assets.head.boy,
            showSheep: false, // ÁæäË¢´Âí¨Ê≠ªÔºå‰∏çÊòæÁ§∫
            name: "ÊóÅÁôΩ",
            text: "‰Ω†ÁöÑÂñäÂ£∞Âú®Â±±Ë∞∑ÈáåÂõûËç°Ôºå‰ΩÜÂ±±‰∏ãÊùëÂ∫ÑÊØ´Êó†Âä®Èùô„ÄÇÊùëÊ∞ë‰ª¨‰ª•‰∏∫‰Ω†ÂèàÂú®ÂºÄÁé©Á¨ë„ÄÇ‰Ω†ÁúºÁùÅÁùÅÂú∞ÁúãÁùÄÊÅ∂ÁãºÂÜ≤ËøõÁæäÁæ§...",
            next: 30.1
        },
        {
            id: 30.1,
            bg: assets.bg.evening,
            char: "WOLF_ATTACKING_SHEEP", // ÁâπÊÆäÂú∫ÊôØ
            head: assets.head.boy,
            name: "Â∞èÁâßÁ´•",
            text: "‰∏ç‚Äî‚ÄîÔºÅÂ§ïÈò≥‰∏ãÔºåÂè™Ââ©‰∏ãÊàëÂ≠§Áã¨ËÄåÊÇîÊÅ®ÁöÑÂì≠Â£∞„ÄÇ",
            next: 99
        },
        // ÁªìÂ±Ä‰∫åÔºö‰æ•Âπ∏ÁöÑ‰ª£‰ª∑ (Neutral Ending)
        {
            id: 31,
            bg: assets.bg.evening,
            char: "VILLAGERS_LATE_ARRIVAL", 
            head: assets.head.boy,
            showSheep: true,
            name: "ÊóÅÁôΩ",
            text: "ÊùëÊ∞ë‰ª¨ËøüÁñë‰∫ÜÂæà‰πÖÔºåÊúÄÁªàÂá†‰∏™ÊùëÊ∞ëÂçä‰ø°ÂçäÁñëÂú∞Ë∑ë‰∏äÂ±±„ÄÇÂõ†‰∏∫‰ªñ‰ª¨ÁöÑËøüÁñëÔºåËôΩÁÑ∂Ëµ∂Ë∑ë‰∫ÜÁãºÔºå‰ΩÜÂ∑≤ÁªèÊúâÂá†Âè™ÁæäË¢´Âí¨‰º§Êàñ‰∏¢Â§±‰∫Ü„ÄÇ",
            next: 31.1
        },
        {
            id: 31.1,
            bg: assets.bg.evening,
            char: assets.char.boyPout,
            anim: "anim-idle",
            head: assets.head.boy,
            showSheep: true, // ÊòæÁ§∫Âèó‰º§ÁöÑÁæä
            name: "ÊóÅÁôΩ",
            text: "‰Ω†‰øù‰Ωè‰∫ÜÂ§ßÈÉ®ÂàÜÁæäÔºå‰ΩÜÊùëÊ∞ë‰ª¨Áúã‰Ω†ÁöÑÁúºÁ•ûÂÖÖÊª°‰∫ÜË¥£Â§á„ÄÇ‰Ω†Ê∑±ÂàªÂú∞‰Ωì‰ºöÂà∞Ôºå‰ø°‰ªª‰∏ÄÊó¶Âá∫Áé∞Ë£ÇÁóïÔºå‰ª£‰ª∑ÊòØÂ¶ÇÊ≠§Ê≤âÈáç„ÄÇ",
            next: 99
        },
        // ÁªìÂ±Ä‰∏âÔºö‰ø°‰ªªÁöÑÂõûÂìç (Good Ending)
        {
            id: 32,
            bg: assets.bg.evening,
            char: "VILLAGERS_CHARGE", 
            head: assets.head.boy,
            showSheep: true,
            name: "ÊóÅÁôΩ",
            text: "Âê¨Âà∞‰Ω†ÊÉäÊÅêÁöÑÂëºÊïëÂ£∞ÔºåÊùëÊ∞ë‰ª¨Ê≤°Êúâ‰∏ùÊØ´ÁäπË±´ÔºåÁ´ãÂàªÊäÑËµ∑Â∑•ÂÖ∑ÂÜ≤‰∏äÂ±±Âù°„ÄÇÂú®Â§ßÂÆ∂ÈΩêÂøÉÂçèÂäõ‰∏ãÔºåÊÅ∂ÁãºÂæàÂø´Ë¢´Ëµ∂Ë∑ë‰∫ÜÔºÅ",
            next: 32.1
        },
        {
            id: 32.1,
            bg: assets.bg.evening,
            char: assets.char.boyNormal,
            anim: "anim-idle",
            head: assets.head.boy,
            showSheep: true,
            name: "ÊùëÈïø",
            text: "Â•ΩÂ≠©Â≠êÔºåÂ§ö‰∫è‰∫Ü‰Ω†ÁöÑË≠¶Êä•ÔºÅ‰Ω†ÁöÑËØöÂÆûÊïë‰∫ÜÂ§ßÂÆ∂ÔºÅ(ÊùëÈïøÊãç‰∫ÜÊãç‰Ω†ÁöÑËÇ©ËÜÄ)",
            next: 99
        },
        // QTEÂ§±Ë¥•ÁªìÂ±Ä
        {
            id: 40,
            bg: assets.bg.evening,
            char: "GAME_OVER_BITE", 
            head: assets.head.boy,
            name: "Á≥ªÁªü",
            text: "‰Ω†Ë¢´ÂêìÂÇª‰∫ÜÔºåÊ≤°Êù•ÂæóÂèäÂëºÊïë„ÄÇÁãºÂº†ÂºÄË°ÄÁõÜÂ§ßÂè£Êâë‰∫Ü‰∏äÊù•Ôºå‰∏ñÁïåÈô∑ÂÖ•‰∫ÜÈªëÊöó...",
            next: 41
        },
        {
            id: 41,
            bg: assets.bg.class,
            char: null,
            head: assets.head.teacher,
            hideStatus: true,
            name: "ÈúìËÄÅÂ∏à",
            text: "ÂìéÂëÄÔºåÈù¢ÂØπÂç±Èô©Êó∂‰∏ÄÂÆöË¶ÅÊûúÊñ≠Ê±ÇÊïë„ÄÇËøôÊ¨°ÁöÑÊïôËÆ≠Â§™ÊÉ®Áóõ‰∫Ü„ÄÇ",
            choices: [{ txt: "ÈáçÊñ∞ÂºÄÂßã", action: () => restartGame() }]
        },
        
        // ‰ºç ¬∑ ËØæÁ®ãÊÄªÁªì
        {
            id: 99,
            bg: assets.bg.class,
            char: null, 
            head: assets.head.teacher, 
            hideStatus: true, 
            name: "ÈúìËÄÅÂ∏à",
            text: "", // Âä®ÊÄÅÁîüÊàê
            next: 99.1
        },
        {
            id: 99.1,
             bg: assets.bg.class,
            char: null, 
            head: assets.head.teacher, 
            hideStatus: true, 
            name: "ÈúìËÄÅÂ∏à",
            text: "Â•Ω‰∫ÜÔºå‰ªäÂ§©ÁöÑÂØìË®Ä‰∫íÂä®ËØæÂ†ÇÂ∞±Âà∞ËøôÈáå„ÄÇÂ∏åÊúõÂ§ßÂÆ∂ÈÉΩËÉΩÊàê‰∏∫‰∏Ä‰∏™ËØöÂÆûÂÆà‰ø°ÁöÑ‰∫∫„ÄÇÊàë‰ª¨‰∏ãËäÇËØæÂÜçËßÅÔºÅ",
            choices: [{ txt: "ÈáçÊñ∞ÂºÄÂßã", action: () => restartGame() }]
        }
    ];

    const els = {
        scene: document.getElementById('scene-layer'),
        char: document.getElementById('main-char'),
        multiLayer: document.getElementById('multi-char-layer'),
        extra1: document.getElementById('extra-char-1'),
        extra2: document.getElementById('extra-char-2'),
        emote1: document.getElementById('emote-1'),
        emote2: document.getElementById('emote-2'),
        villagerLayer: document.getElementById('villager-layer'),
        v1: document.getElementById('villager-1'),
        v2: document.getElementById('villager-2'),
        v3: document.getElementById('villager-3'),
        portraitFrame: document.getElementById('portrait-frame'),
        portrait: document.getElementById('portrait-img'),
        name: document.getElementById('name-tag'),
        text: document.getElementById('text-content'),
        choices: document.getElementById('choices-box'),
        next: document.getElementById('next-btn'),
        box: document.getElementById('dialogue-area'),
        statusBar: document.getElementById('status-bar'),
        title: document.getElementById('chapter-title'),
        sheepLayer: document.getElementById('sheep-layer'),
        qteBarContainer: document.getElementById('qte-bar-container'),
        qteBar: document.getElementById('qte-bar'),
        jumpscare: document.getElementById('jumpscare-layer'),
        wolfBiteImg: document.getElementById('wolf-bite-img')
    };

    document.querySelectorAll('.sheep').forEach(img => img.src = assets.sheep);

    let typeInterval;

    function render(id) {
        // Âä®ÊÄÅÊäâÊã©Â§ÑÁêÜ
        if (id === 6) {
            const node = JSON.parse(JSON.stringify(script.find(s => s.id === 6)));
            let subNode;
            // credit > 80 (85) -> ÈÄâ‰∫ÜB, ËÆ§ÁúüÊîæÁæä
            if (creditScore >= 85) { 
                subNode = script.find(s => s.id === 6.2);
            } else { // credit <= 80 (50) -> ÈÄâ‰∫ÜA, ÊííË∞é
                subNode = script.find(s => s.id === 6.1);
            }
            node.text = subNode.text;
            renderBase(node, () => {
                showControls(subNode);
            });
            return;
        }

        const node = script.find(s => s.id === id);
        if (!node) return;

        const nodeCopy = JSON.parse(JSON.stringify(node));

        // Âä®ÊÄÅËÆæÁΩÆÊÄªÁªìËØ≠
        if (id === 99) {
            if (creditScore >= 90) { // ÁªìÂ±Ä‰∏â
                 nodeCopy.text = "ÊÅ≠Âñú‰Ω†ÔºåÁî®Ëá™Â∑±ÁöÑËØöÂÆûÂíåË¥£‰ªªÂøÉÔºåÂÆàÊä§‰∫ÜÁæäÁæ§Âíå‰ø°‰ªª„ÄÇ‰Ω†ÁöÑÈÄâÊã©ËØÅÊòé‰∫ÜÔºåËØöÂÆû‰∏ç‰ªÖÊòØÁæéÂæ∑ÔºåÊõ¥ÊòØÂú®ÂÖ≥ÈîÆÊó∂Âàª‰øùÊä§Ëá™Â∑±Âíå‰ªñ‰∫∫ÁöÑÂº∫Â§ßÂäõÈáè„ÄÇ";
            } else { // ÁªìÂ±Ä‰∏Ä/‰∫å
                 nodeCopy.text = "ÁúãÂà∞‰∫ÜÂêóÔºü‰ø°Áî®Â∞±ÂÉè‰∏Ä‰∏™Â≠òÈí±ÁΩêÔºåÊØè‰∏ÄÊ¨°ËØ¥Ë∞éÔºåÈÉΩÊòØÂú®‰ªé‰∏≠ÂèñËµ∞‰ø°‰ªª„ÄÇÂΩìÂ≠òÈí±ÁΩêÁ©∫‰∫ÜÁöÑÊó∂ÂÄôÔºåÊó†ËÆ∫‰Ω†Â§ö‰πàÈúÄË¶ÅÂ∏ÆÂä©Ôºå‰πüÊó†Ê≥ïÂÜçÂèñÂá∫‰∏Ä‰∏ù‰∏ÄÊØ´ÁöÑ‰ø°‰ªª‰∫Ü„ÄÇ";
            }
        }

        renderBase(nodeCopy, () => showControls(nodeCopy));
    }

    function renderBase(node, onComplete) {
        clearTimeout(qteTimer);
        els.qteBarContainer.style.display = 'none';
        els.qteBar.classList.remove('anim-timer');
        els.jumpscare.style.display = 'none';
        els.scene.classList.remove('blackout-mode');
        
        document.querySelectorAll('.sheep').forEach(s => {
            s.classList.remove('anim-sheep-scatter-left', 'anim-sheep-scatter-right');
            s.style.opacity = '1';
            s.src = assets.sheep;
            s.style.animationName = s.classList.contains('sheep-enter-left') ? 'walkFromLeft' : 
                                  s.classList.contains('sheep-enter-right') ? 'walkFromRight' : 
                                  s.classList.contains('sheep-wander-1') ? 'wanderSlow1' : 'wanderSlow2';
        });

        els.statusBar.style.display = node.hideStatus ? 'none' : 'flex';

        if (node.bg) els.scene.style.backgroundImage = `url('${node.bg}')`;

        els.sheepLayer.style.display = node.showSheep ? 'block' : 'none';

        if (node.showTitle) {
            els.title.innerText = node.showTitle;
            els.title.classList.remove('anim-title-show');
            void els.title.offsetWidth; 
            els.title.classList.add('anim-title-show');
        }

        els.multiLayer.style.display = 'none';
        els.villagerLayer.style.display = 'none';
        els.char.style.display = 'none';
        els.char.className = 'sprite'; 
        [els.extra1, els.extra2, els.v1, els.v2, els.v3].forEach(el => {
            el.className = 'sub-sprite';
            el.style.display = 'none';
        });
        
        // ÁâπÊÆäÂú∫ÊôØÊ∏≤Êüì
        if (node.char === "VILLAGERS_RUN_IN_WEAPONS") {
            els.multiLayer.style.display = 'block';
            els.char.src = assets.char.boyLaugh;
            els.char.style.display = 'block';
            els.char.classList.add('anim-jump');
            
            els.extra1.src = assets.char.vMachete;
            els.extra1.style.display = 'block';
            els.extra1.className = "sub-sprite anim-slide-in-left-stop";
            
            els.extra2.src = assets.char.vStick;
            els.extra2.style.display = 'block';
            els.extra2.style.transform = "scaleX(-1)"; 
            els.extra2.className = "sub-sprite anim-slide-in-right-stop";
        } else if (node.char === "VILLAGERS_ANGRY_LEAVING") {
             els.multiLayer.style.display = 'block';
             els.char.src = assets.char.boyArrogant;
             els.char.style.display = 'block';
             
             els.extra1.src = assets.char.vMacheteAngry;
             els.extra1.style.left = '20%';
             els.extra1.style.display = 'block';
             els.extra1.classList.add('anim-villagers-leave');

             els.extra2.src = assets.char.vStickAngry;
             els.extra2.style.right = '20%';
             els.extra2.style.transform = "scaleX(-1)";
             els.extra2.style.display = 'block';
             els.extra2.classList.add('anim-villagers-leave');
        } else if (node.char === "WOLF_CENTER") {
            els.multiLayer.style.display = 'block';
            els.char.src = assets.char.boyScared;
            els.char.style.left = '20%';
            els.char.style.display = 'block';
            els.char.classList.add('anim-shake');
            els.extra1.src = assets.char.wolf;
            els.extra1.style.display = 'block';
            els.extra1.className = "sub-sprite anim-wolf-pop";
        } else if (node.char === "QTE_SCENE") {
            els.multiLayer.style.display = 'block';
            els.extra1.src = assets.char.boyScared;
            els.extra1.style.display = 'block'; 
            els.extra1.className = "sub-sprite anim-shake";
            els.extra1.style.left = "20%"; 
            els.extra2.src = assets.char.wolf;
            els.extra2.style.display = 'block';
            els.extra2.className = "sub-sprite anim-wolf-approach"; 
            
            els.qteBarContainer.style.display = 'block';
            void els.qteBar.offsetWidth; 
            els.qteBar.classList.add('anim-timer');
            qteTimer = setTimeout(() => render(40), 5000);
        } else if (node.char === "WOLF_ATTACKING_SHEEP") {
             els.multiLayer.style.display = 'block';
             els.extra1.src = assets.char.boyCry;
             els.extra1.style.left = '20%';
             els.extra1.style.display = 'block';
             els.sheepLayer.style.display = 'block';
             document.querySelectorAll('.sheep').forEach(s => {
                s.src = assets.sheepDead;
                s.style.animation = 'none';
            });
        } else if (node.char === "VILLAGERS_LATE_ARRIVAL") {
             els.multiLayer.style.display = 'block';
             els.villagerLayer.style.display = 'block';
             els.char.src = assets.char.boyPout;
             els.char.style.display = 'block';
             els.char.style.left = '20%';
             
             els.extra1.src = assets.char.wolf;
             els.extra1.style.display = 'block';
             els.extra1.style.left = '45%';
             els.extra1.className = "sub-sprite anim-wolf-flee"; 

             els.v1.src = assets.char.vMacheteAngry;
             els.v1.style.display = 'block';
             els.v1.style.left = '40%';
             
             document.querySelectorAll('.sheep')[0].src = assets.sheepLost; // ‰∏ÄÂè™ÁæäÂèó‰º§
             document.querySelectorAll('.sheep')[0].style.animation = 'none';
        } else if (node.char === "VILLAGERS_CHARGE") {
            els.multiLayer.style.display = 'block';
            els.villagerLayer.style.display = 'block';
            els.extra1.src = assets.char.boyScared;
            els.extra1.style.display = 'block';
            els.extra1.className = "sub-sprite anim-shake";
            els.extra1.style.left = "20%";
            els.extra2.src = assets.char.wolf;
            els.extra2.style.display = 'block';
            els.extra2.style.left = '45%';
            els.extra2.className = "sub-sprite anim-wolf-flee"; 

            els.v1.src = assets.char.vMachete; els.v1.style.display = 'block';
            els.v1.className = "sub-sprite anim-villager-charge-1"; 
            els.v1.style.setProperty('--target-left', '45%');

            els.v2.src = assets.char.vStick; els.v2.style.display = 'block';
            els.v2.className = "sub-sprite anim-villager-charge-2"; 
            els.v2.style.setProperty('--target-left', '35%');

            els.v3.src = assets.char.vHoe; els.v3.style.display = 'block';
            els.v3.className = "sub-sprite anim-villager-charge-3"; 
            els.v3.style.setProperty('--target-left', '55%');
        } else if (node.char === "GAME_OVER_BITE") {
            els.wolfBiteImg.src = assets.char.wolfBite;
            els.jumpscare.style.display = 'flex';
            document.querySelectorAll('.sheep').forEach((s, i) => {
                s.classList.add(i % 2 === 0 ? 'anim-sheep-scatter-left' : 'anim-sheep-scatter-right');
            });
            setTimeout(() => els.scene.classList.add('blackout-mode'), 350);
        } else if (node.char) {
            els.char.src = node.char;
            els.char.style.display = 'block';
            if (node.anim) els.char.classList.add(node.anim);
        }

        if (node.head) {
            els.portrait.src = node.head;
            els.portraitFrame.style.visibility = 'visible';
        } else {
            els.portraitFrame.style.visibility = 'hidden';
        }

        els.name.innerText = node.name || "Á≥ªÁªü";
        els.choices.innerHTML = '';
        els.next.style.display = 'none';
        
        els.text.innerText = '';
        let i = 0;
        clearInterval(typeInterval);
        
        els.box.onclick = () => {
            if (i < node.text.length) {
                clearInterval(typeInterval);
                els.text.innerText = node.text;
                i = node.text.length + 1; // Mark as finished
                onComplete();
            } else if (node.next && !node.choices && !node.dynamicChoices) {
                render(node.next);
            }
        };

        typeInterval = setInterval(() => {
            if (i < node.text.length) {
                els.text.innerText += node.text.charAt(i);
                i++;
            } else {
                clearInterval(typeInterval);
                onComplete();
            }
        }, 30);
    }

    function showControls(node) {
        if (node.choices) {
            node.choices.forEach(c => {
                let btn = document.createElement('button');
                btn.className = 'pixel-btn';
                btn.innerText = c.txt;
                btn.onclick = (e) => {
                    e.stopPropagation();
                    if (qteTimer) clearTimeout(qteTimer); 
                    if (c.action) c.action();
                    if (c.dynamicNext) {
                        render(getWolfEnding());
                    } else if (c.to) {
                        render(c.to);
                    }
                };
                els.choices.appendChild(btn);
            });
        } else if (node.next) {
            els.next.style.display = 'block';
        }
    }

    window.restartGame = function() { 
        creditScore = 80;
        updateCredit(0); 
        render(1); 
    }
    
    window.onload = () => {
        updateCredit(0);
        render(1);
    }

</script>
</body>
</html>